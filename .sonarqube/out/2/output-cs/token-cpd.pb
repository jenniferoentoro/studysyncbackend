ƒ)
zd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Authentication\FirebaseAuthenticationHandler.cs
	namespace 	
user_service
 
. 
Authentication %
{ 
public 

class )
FirebaseAuthenticationHandler .
:/ 0!
AuthenticationHandler1 F
<F G'
AuthenticationSchemeOptionsG b
>b c
{ 
private 
readonly 
FirebaseApp $
_firebaseApp% 1
;1 2
public )
FirebaseAuthenticationHandler ,
(, -
IOptionsMonitor- <
<< ='
AuthenticationSchemeOptions= X
>X Y
optionsZ a
,a b
ILoggerFactoryc q
loggerr x
,x y

UrlEncoder	z Ñ
encoder
Ö å
,
å ç
ISystemClock
é ö
clock
õ †
,
† °
FirebaseApp
¢ ≠
firebaseApp
Æ π
)
π ∫
:
ª º
base
Ω ¡
(
¡ ¬
options
¬ …
,
…  
logger
À —
,
— “
encoder
” ⁄
,
⁄ €
clock
‹ ·
)
· ‚
{ 	
_firebaseApp 
= 
firebaseApp &
;& '
} 	
	protected 
override 
async  
Task! %
<% &
AuthenticateResult& 8
>8 9#
HandleAuthenticateAsync: Q
(Q R
)R S
{ 	
if 
( 
! 
Context 
. 
Request  
.  !
Headers! (
.( )
ContainsKey) 4
(4 5
$str5 D
)D E
)E F
{ 
return 
AuthenticateResult )
.) *
NoResult* 2
(2 3
)3 4
;4 5
} 
string 
bearerToken 
=  
Context! (
.( )
Request) 0
.0 1
Headers1 8
[8 9
$str9 H
]H I
;I J
if   
(   
bearerToken   
==   
null   #
||  $ &
!  ' (
bearerToken  ( 3
.  3 4

StartsWith  4 >
(  > ?
$str  ? H
)  H I
)  I J
{!! 
return"" 
AuthenticateResult"" )
."") *
Fail""* .
("". /
$str""/ M
)""M N
;""N O
}## 
string%% 
token%% 
=%% 
bearerToken%% &
.%%& '
	Substring%%' 0
(%%0 1
$str%%1 :
.%%: ;
Length%%; A
)%%A B
;%%B C
try'' 
{(( 
FirebaseToken)) 
firebaseToken)) +
=)), -
await)). 3
FirebaseAuth))4 @
.))@ A
GetAuth))A H
())H I
_firebaseApp))I U
)))U V
.))V W
VerifyIdTokenAsync))W i
())i j
token))j o
)))o p
;))p q
return-- 
AuthenticateResult-- )
.--) *
Success--* 1
(--1 2
new--2 5 
AuthenticationTicket--6 J
(--J K
new--K N
ClaimsPrincipal--O ^
(--^ _
new--_ b
List--c g
<--g h
ClaimsIdentity--h v
>--v w
{--w x
new.. 
ClaimsIdentity.. "
(.." #
ToClaims..# +
(..+ ,
firebaseToken.., 9
...9 :
Claims..: @
)..@ A
,..A B
nameof..C I
(..I J)
FirebaseAuthenticationHandler..J g
)..g h
)..h i
}// 
)// 
,// 
JwtBearerDefaults// !
.//! " 
AuthenticationScheme//" 6
)//6 7
)//7 8
;//8 9
}00 
catch11 
(11 
	Exception11 
e11 
)11 
{22 
return33 
AuthenticateResult33 )
.33) *
Fail33* .
(33. /
e33/ 0
.330 1
Message331 8
)338 9
;339 :
}44 
}77 	
private99 
IEnumerable99 
<99 
Claim99 !
>99! "
ToClaims99# +
(99+ ,
IReadOnlyDictionary99, ?
<99? @
string99@ F
,99F G
object99H N
>99N O
claims99P V
)99V W
{:: 	
return;; 
new;; 
List;; 
<;; 
Claim;; !
>;;! "
{<< 
new== 
Claim== 
(== 
$str== 
,== 
claims==  &
[==& '
$str==' 0
]==0 1
.==1 2
ToString==2 :
(==: ;
)==; <
)==< =
,=== >
new>> 
Claim>> 
(>> 
$str>> !
,>>! "
claims>># )
[>>) *
$str>>* 1
]>>1 2
.>>2 3
ToString>>3 ;
(>>; <
)>>< =
)>>= >
,>>> ?
}@@ 
;@@ 
}AA 	
}BB 
}CC èl
hd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Controllers\UserController.cs
	namespace 	
user_service
 
. 
Controllers "
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IUserService %
_userService& 2
;2 3
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserController 
( 
IUserService *
userService+ 6
,6 7
IMapper8 ?
mapper@ F
)F G
{ 	
_userService 
= 
userService &
;& '
_mapper 
= 
mapper 
; 
} 	
[ 	
	Authorize	 
] 
[ 	
HttpGet	 
( 
$str 
) 
] 
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
GetAll!!) /
(!!/ 0
)!!0 1
{"" 	
var## 
users## 
=## 
await## 
_userService## *
.##* +
GetAllUsers##+ 6
(##6 7
)##7 8
;##8 9
return$$ 
Ok$$ 
($$ 
_mapper$$ 
.$$ 
Map$$ !
<$$! "
IEnumerable$$" -
<$$- .
UserDto$$. 5
>$$5 6
>$$6 7
($$7 8
users$$8 =
)$$= >
)$$> ?
;$$? @
}%% 	
['' 	
	Authorize''	 
]'' 
[(( 	
HttpGet((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
ActionResult)) &
<))& '
UserDto))' .
>)). /
>))/ 0
GetUserById))1 <
())< =
int))= @
id))A C
)))C D
{** 	
var++ 
user++ 
=++ 
await++ 
_userService++ )
.++) *
GetUser++* 1
(++1 2
id++2 4
)++4 5
;++5 6
if,, 
(,, 
user,, 
==,, 
null,, 
),, 
{-- 
return.. 
NotFound.. 
(..  
)..  !
;..! "
}// 
return00 
Ok00 
(00 
_mapper00 
.00 
Map00 !
<00! "
UserDto00" )
>00) *
(00* +
user00+ /
)00/ 0
)000 1
;001 2
}11 	
[33 	
	Authorize33	 
]33 
[44 	
HttpGet44	 
(44 
$str44  
)44  !
]44! "
public55 
ActionResult55 
<55 
UserDto55 #
>55# $
GetUserByEmail55% 3
(553 4
string554 :
email55; @
)55@ A
{66 	
var77 
user77 
=77 
_userService77 #
.77# $
GetUserByEmail77$ 2
(772 3
email773 8
)778 9
;779 :
if88 
(88 
user88 
==88 
null88 
)88 
{99 
return:: 
NotFound:: 
(::  
)::  !
;::! "
};; 
return<< 
Ok<< 
(<< 
_mapper<< 
.<< 
Map<< !
<<<! "
UserDto<<" )
><<) *
(<<* +
user<<+ /
)<</ 0
)<<0 1
;<<1 2
}== 	
[?? 	
HttpPost??	 
(?? 
$str?? 
)?? 
]?? 
public@@ 
ActionResult@@ 
<@@ 
UserDto@@ #
>@@# $

CreateUser@@% /
(@@/ 0
[@@0 1
FromBody@@1 9
]@@9 :
CreateUserDto@@; H
userDto@@I P
)@@P Q
{AA 	
ifBB 
(BB 
!BB 

ModelStateBB 
.BB 
IsValidBB #
)BB# $
{CC 
returnDD 

BadRequestDD !
(DD! "

ModelStateDD" ,
)DD, -
;DD- .
}EE 
ifGG 
(GG 
!GG 
EnumGG 
.GG 
TryParseGG 
(GG 
userDtoGG &
.GG& '
GradeGG' ,
,GG, -
outGG. 1
GradeGG2 7
gradeGG8 =
)GG= >
)GG> ?
{HH 
returnII 

BadRequestII !
(II! "
$strII" 8
)II8 9
;II9 :
}JJ 
varLL 
userArgsLL 
=LL 
newLL 
UserRecordArgsLL -
(LL- .
)LL. /
{MM 
EmailNN 
=NN 
userDtoNN 
.NN  
EmailNN  %
,NN% &
EmailVerifiedOO 
=OO 
falseOO  %
,OO% &
PasswordPP 
=PP 
userDtoPP "
.PP" #
PasswordPP# +
,PP+ ,
DisplayNameQQ 
=QQ 
userDtoQQ %
.QQ% &
NameQQ& *
,QQ* +
DisabledRR 
=RR 
falseRR  
}SS 
;SS 
varUU 

userRecordUU 
=UU 
FirebaseAuthUU )
.UU) *
DefaultInstanceUU* 9
.UU9 :
CreateUserAsyncUU: I
(UUI J
userArgsUUJ R
)UUR S
;UUS T
ifXX 
(XX 

userRecordXX 
.XX 
ResultXX !
==XX" $
nullXX% )
)XX) *
{YY 
returnZZ 

BadRequestZZ !
(ZZ! "
$strZZ" 9
)ZZ9 :
;ZZ: ;
}[[ 
var^^ 
user^^ 
=^^ 
new^^ 
User^^ 
{__ 
Name`` 
=`` 
userDto`` 
.`` 
Name`` #
,``# $
Emailaa 
=aa 
userDtoaa 
.aa  
Emailaa  %
,aa% &
Gradebb 
=bb 
gradebb 
,bb 
Schoolcc 
=cc 
userDtocc  
.cc  !
Schoolcc! '
,cc' (
Roledd 
=dd 
Roledd 
.dd 
Userdd  
}ee 
;ee 
_userServiceff 
.ff 

CreateUserff #
(ff# $
userff$ (
)ff( )
;ff) *
returngg 
CreatedAtActiongg "
(gg" #
nameofgg# )
(gg) *
GetUserByIdgg* 5
)gg5 6
,gg6 7
newgg8 ;
{gg< =
idgg> @
=ggA B
userggC G
.ggG H
IdggH J
}ggK L
,ggL M
userggN R
)ggR S
;ggS T
}hh 	
[jj 	
	Authorizejj	 
]jj 
[kk 	
HttpPostkk	 
(kk 
$strkk 
)kk 
]kk 
publicmm 
ActionResultmm 
<mm 
UserDtomm #
>mm# $
CreateAdminmm% 0
(mm0 1
[mm1 2
FromBodymm2 :
]mm: ;
CreateAdminDtomm< J
userDtommK R
)mmR S
{nn 	
ifoo 
(oo 
!oo 

ModelStateoo 
.oo 
IsValidoo #
)oo# $
{pp 
returnqq 

BadRequestqq !
(qq! "

ModelStateqq" ,
)qq, -
;qq- .
}rr 
vartt 
usertt 
=tt 
newtt 
Usertt 
{uu 
Namevv 
=vv 
userDtovv 
.vv 
Namevv #
,vv# $
Emailww 
=ww 
userDtoww 
.ww  
Emailww  %
,ww% &
Gradexx 
=xx 
Gradexx 
.xx 
Unknownxx %
,xx% &
Schoolyy 
=yy 
nullyy 
!yy 
,yy 
Rolezz 
=zz 
Rolezz 
.zz 
Adminzz !
}{{ 
;{{ 
_userService|| 
.|| 

CreateUser|| #
(||# $
user||$ (
)||( )
;||) *
return}} 
CreatedAtAction}} "
(}}" #
nameof}}# )
(}}) *
GetUserById}}* 5
)}}5 6
,}}6 7
new}}8 ;
{}}< =
id}}> @
=}}A B
user}}C G
.}}G H
Id}}H J
}}}K L
,}}L M
user}}N R
)}}R S
;}}S T
}~~ 	
[ 	
	Authorize	 
] 
[
ÄÄ 	
HttpPut
ÄÄ	 
(
ÄÄ 
$str
ÄÄ 
)
ÄÄ 
]
ÄÄ 
public
ÅÅ 
async
ÅÅ 
Task
ÅÅ 
<
ÅÅ 
ActionResult
ÅÅ &
<
ÅÅ& '
UserDto
ÅÅ' .
>
ÅÅ. /
>
ÅÅ/ 0

UpdateUser
ÅÅ1 ;
(
ÅÅ; <
[
ÅÅ< =
	FromRoute
ÅÅ= F
]
ÅÅF G
int
ÅÅH K
id
ÅÅL N
,
ÅÅN O
[
ÅÅP Q
FromBody
ÅÅQ Y
]
ÅÅY Z
UpdateUserDto
ÅÅ[ h
userDto
ÅÅi p
)
ÅÅp q
{
ÇÇ 	
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 

ModelState
ÉÉ 
.
ÉÉ 
IsValid
ÉÉ #
)
ÉÉ# $
{
ÑÑ 
return
ÖÖ 

BadRequest
ÖÖ !
(
ÖÖ! "

ModelState
ÖÖ" ,
)
ÖÖ, -
;
ÖÖ- .
}
ÜÜ 
if
àà 
(
àà 
!
àà 
Enum
àà 
.
àà 
TryParse
àà 
(
àà 
userDto
àà &
.
àà& '
Grade
àà' ,
,
àà, -
out
àà. 1
Grade
àà2 7
grade
àà8 =
)
àà= >
)
àà> ?
{
ââ 
return
ãã 

BadRequest
ãã !
(
ãã! "
$str
ãã" 8
)
ãã8 9
;
ãã9 :
}
åå 
var
éé 
user
éé 
=
éé 
await
éé 
_userService
éé )
.
éé) *
GetUser
éé* 1
(
éé1 2
id
éé2 4
)
éé4 5
;
éé5 6
if
èè 
(
èè 
user
èè 
==
èè 
null
èè 
)
èè 
{
êê 
return
ëë 
NotFound
ëë 
(
ëë  
)
ëë  !
;
ëë! "
}
íí 
user
îî 
.
îî 
Name
îî 
=
îî 
userDto
îî 
.
îî  
Name
îî  $
;
îî$ %
user
ïï 
.
ïï 
Grade
ïï 
=
ïï 
grade
ïï 
;
ïï 
user
ññ 
.
ññ 
School
ññ 
=
ññ 
userDto
ññ !
.
ññ! "
School
ññ" (
;
ññ( )
_userService
óó 
.
óó 

UpdateUser
óó #
(
óó# $
user
óó$ (
)
óó( )
;
óó) *
return
ôô 
Ok
ôô 
(
ôô 
_mapper
ôô 
.
ôô 
Map
ôô !
<
ôô! "
UserDto
ôô" )
>
ôô) *
(
ôô* +
user
ôô+ /
)
ôô/ 0
)
ôô0 1
;
ôô1 2
}
öö 	
[
úú 	
	Authorize
úú	 
]
úú 
[
ùù 	

HttpDelete
ùù	 
(
ùù 
$str
ùù 
)
ùù 
]
ùù  
public
ûû 
async
ûû 
Task
ûû 
<
ûû 
ActionResult
ûû &
>
ûû& '

DeleteUser
ûû( 2
(
ûû2 3
int
ûû3 6
id
ûû7 9
)
ûû9 :
{
üü 	
var
†† 
user
†† 
=
†† 
await
†† 
_userService
†† )
.
††) *
GetUser
††* 1
(
††1 2
id
††2 4
)
††4 5
;
††5 6
if
°° 
(
°° 
user
°° 
==
°° 
null
°° 
)
°° 
{
¢¢ 
return
££ 
NotFound
££ 
(
££  
)
££  !
;
££! "
}
§§ 
_userService
•• 
.
•• 

DeleteUser
•• #
(
••# $
id
••$ &
)
••& '
;
••' (

UserRecord
®® 

userRecord
®® !
=
®®" #
await
®®$ )
FirebaseAuth
®®* 6
.
®®6 7
DefaultInstance
®®7 F
.
®®F G!
GetUserByEmailAsync
®®G Z
(
®®Z [
user
®®[ _
.
®®_ `
Email
®®` e
)
®®e f
;
®®f g
if
™™ 
(
™™ 

userRecord
™™ 
==
™™ 
null
™™ "
)
™™" #
{
´´ 
return
¨¨ 
NotFound
¨¨ 
(
¨¨  
)
¨¨  !
;
¨¨! "
}
≠≠ 
await
ØØ 
FirebaseAuth
ØØ 
.
ØØ 
DefaultInstance
ØØ .
.
ØØ. /
DeleteUserAsync
ØØ/ >
(
ØØ> ?

userRecord
ØØ? I
.
ØØI J
Uid
ØØJ M
)
ØØM N
;
ØØN O
return
≤≤ 
Ok
≤≤ 
(
≤≤ 
_mapper
≤≤ 
.
≤≤ 
Map
≤≤ !
<
≤≤! "
UserDto
≤≤" )
>
≤≤) *
(
≤≤* +
user
≤≤+ /
)
≤≤/ 0
)
≤≤0 1
;
≤≤1 2
}
≥≥ 	
}
√√ 
}ƒƒ ⁄
_d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Data\AppDbContext.cs
	namespace 	
user_service
 
. 
Data 
{ 
public 

class 
AppDbContext 
: 
	DbContext  )
{ 
	protected		 
readonly		 
IConfiguration		 )
Configuration		* 7
;		7 8
public 
AppDbContext 
( 
IConfiguration *
configuration+ 8
)8 9
{ 	
Configuration 
= 
configuration )
;) *
} 	
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
optionsBuilder 
. 
	UseNpgsql $
($ %
Configuration% 2
.2 3
GetConnectionString3 F
(F G
$strG W
)W X
)X Y
;Y Z
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
. 
Property 
( 
u 
=> 
u  
.  !
Role! %
)% &
. 
HasConversion 
< 
string %
>% &
(& '
)' (
;( )
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
. 
Property 
( 
u 
=> 
u  
.  !
Grade! &
)& '
. 
HasConversion 
< 
string %
>% &
(& '
)' (
;( )
} 	
}   
}!! Æ
ad:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\CreateAdminDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
CreateAdminDto		 
{

 
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str E
,E F
ErrorMessageG S
=T U
$str	V ≤
)
≤ ≥
]
≥ ¥
[ 	
	MinLength	 
( 
$num 
, 
ErrorMessage "
=# $
$str% S
)S T
]T U
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
null/ 3
!3 4
;4 5
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< ]
)] ^
]^ _
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
} 
} ≈
`d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\CreateUserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
CreateUserDto		 
{

 
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str E
,E F
ErrorMessageG S
=T U
$str	V ≤
)
≤ ≥
]
≥ ¥
[ 	
	MinLength	 
( 
$num 
, 
ErrorMessage "
=# $
$str% S
)S T
]T U
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
null/ 3
!3 4
;4 5
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< ]
)] ^
]^ _
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
[ 	
Required	 
] 
public 
string 
Grade 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
} 
}   Ë	
_d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\LoginUserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
LoginUserDto		 
{

 
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str E
,E F
ErrorMessageG S
=T U
$str	V ≤
)
≤ ≥
]
≥ ¥
[ 	
	MinLength	 
( 
$num 
, 
ErrorMessage "
=# $
$str% S
)S T
]T U
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
null/ 3
!3 4
;4 5
} 
} Î
`d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\UpdateUserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
UpdateUserDto		 
{

 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< ]
)] ^
]^ _
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 
string 
Grade 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
} 
} È

Zd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\UserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
UserDto		 
{

 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 
Grade 
Grade 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
public 
Role 
Role 
{ 
get 
; 
set  #
;# $
}% &
} 
} ü
ld:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Migrations\20240315121037_init.cs
	namespace 	
user_service
 
. 

Migrations !
{ 
public		 

partial		 
class		 
init		 
:		 
	Migration		  )
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ D
,D E)
NpgsqlValueGenerationStrategyF c
.c d#
IdentityByDefaultColumnd {
){ |
,| }
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
Password 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Grade 
= 
table !
.! "
Column" (
<( )
int) ,
>, -
(- .
type. 2
:2 3
$str4 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
School 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
Role 
= 
table  
.  !
Column! '
<' (
int( +
>+ ,
(, -
type- 1
:1 2
$str3 <
,< =
nullable> F
:F G
falseH M
)M N
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
} 	
	protected"" 
override"" 
void"" 
Down""  $
(""$ %
MigrationBuilder""% 5
migrationBuilder""6 F
)""F G
{## 	
migrationBuilder$$ 
.$$ 
	DropTable$$ &
($$& '
name%% 
:%% 
$str%% 
)%% 
;%% 
}&& 	
}'' 
}(( ¢
yd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Migrations\20240315152832_enumstringconvert.cs
	namespace 	
user_service
 
. 

Migrations !
{ 
public 

partial 
class 
enumstringconvert *
:+ ,
	Migration- 6
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
)" #
;# $
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
)" #
;# $
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{   	
migrationBuilder!! 
.!! 
AlterColumn!! (
<!!( )
int!!) ,
>!!, -
(!!- .
name"" 
:"" 
$str"" 
,"" 
table## 
:## 
$str## 
,## 
type$$ 
:$$ 
$str$$ 
,$$  
nullable%% 
:%% 
false%% 
,%%  

oldClrType&& 
:&& 
typeof&& "
(&&" #
string&&# )
)&&) *
,&&* +
oldType'' 
:'' 
$str'' 
)''  
;''  !
migrationBuilder)) 
.)) 
AlterColumn)) (
<))( )
int))) ,
>)), -
())- .
name** 
:** 
$str** 
,** 
table++ 
:++ 
$str++ 
,++ 
type,, 
:,, 
$str,, 
,,,  
nullable-- 
:-- 
false-- 
,--  

oldClrType.. 
:.. 
typeof.. "
(.." #
string..# )
)..) *
,..* +
oldType// 
:// 
$str// 
)//  
;//  !
}00 	
}11 
}22 Ë
vd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Migrations\20240315170748_removepassword.cs
	namespace 	
user_service
 
. 

Migrations !
{ 
public 

partial 
class 
removepassword '
:( )
	Migration* 3
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str  
,  !
table 
: 
$str 
) 
;  
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str  
,  !
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
} 	
} 
} ¡
Yd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Model\Grade.cs
	namespace 	
user_service
 
. 
Model 
{ 
public 

enum 
Grade 
{ 

Elementary 
, 
Middle 
, 
High  
,  !
College" )
,) *
Unknown+ 2
} 
} œ
Xd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Model\Role.cs
	namespace 	
user_service
 
. 
Model 
{ 
public 

enum 
Role 
{ 
User 
, 
Admin 
} 
} ò
Xd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Model\User.cs
	namespace 	
user_service
 
. 
model 
{		 
public

 

class

 
User

 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
[ 	
Required	 
] 
public 
Grade 
Grade 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
[ 	
Required	 
] 
public 
Role 
Role 
{ 
get 
; 
set  #
;# $
}% &
} 
}   õ
dd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Profile\MappingProfile.cs
	namespace		 	
user_service		
 
.		 
Profile		 
{

 
public 

class 
MappingProfile 
:  !

AutoMapper" ,
., -
Profile- 4
{ 
public 
MappingProfile 
( 
) 
{ 	
	CreateMap 
< 
User 
, 
UserDto #
># $
($ %
)% &
;& '
	CreateMap 
< 
UserDto 
, 
User #
># $
($ %
)% &
;& '
} 	
} 
} í1
Ud:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
.! "
AddJsonOptions" 0
(0 1
options1 8
=>9 ;
options 
. 	!
JsonSerializerOptions	 
. 

Converters )
.) *
Add* -
(- .
new. 1#
JsonStringEnumConverter2 I
(I J
)J K
)K L
)L M
;M N
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddAutoMapper 
( 
typeof %
(% &
Program& -
)- .
). /
;/ 0
builder 
. 
Services 
. 
AddAuthentication "
(" #
JwtBearerDefaults# 4
.4 5 
AuthenticationScheme5 I
)I J
.J K
	AddSchemeK T
<T U'
AuthenticationSchemeOptionsU p
,p q*
FirebaseAuthenticationHandler	r è
>
è ê
(
ê ë
JwtBearerDefaults
ë ¢
.
¢ £"
AuthenticationScheme
£ ∑
,
∑ ∏
(
π ∫
o
∫ ª
)
ª º
=>
Ω ø
{
¿ ¡
}
¬ √
)
√ ƒ
;
ƒ ≈
builder 
. 
Services 
. 
AddSwaggerGen 
( 
option %
=>& (
{ 
option 

.
 

SwaggerDoc 
( 
$str 
, 
new 
OpenApiInfo  +
{, -
Title. 3
=4 5
$str6 @
,@ A
VersionB I
=J K
$strL P
}Q R
)R S
;S T
option 

.
 !
AddSecurityDefinition  
(  !
$str! )
,) *
new+ .!
OpenApiSecurityScheme/ D
{ 
In 

= 
ParameterLocation 
. 
Header %
,% &
Description 
= 
$str 2
,2 3
Name   
=   
$str   
,   
Type!! 
=!! 
SecuritySchemeType!! !
.!!! "
Http!!" &
,!!& '
BearerFormat"" 
="" 
$str"" 
,"" 
Scheme## 
=## 
$str## 
}$$ 
)$$ 
;$$ 
option%% 

.%%
 "
AddSecurityRequirement%% !
(%%! "
new%%" %&
OpenApiSecurityRequirement%%& @
{&& 
{'' 	
new(( !
OpenApiSecurityScheme(( %
{)) 
	Reference** 
=** 
new** 
OpenApiReference**  0
{++ 
Type,, 
=,, 
ReferenceType,, &
.,,& '
SecurityScheme,,' 5
,,,5 6
Id-- 
=-- 
$str-- 
}.. 
}// 
,// 
new00 
string00 
[00 
]00 
{00 
}00 
}11 	
}22 
)22 
;22 
}33 
)33 
;33 
builder44 
.44 
Services44 
.44 
AddSingleton44 
(44 
FirebaseApp44 )
.44) *
Create44* 0
(440 1
new441 4

AppOptions445 ?
(44? @
)44@ A
{55 

Credential66 
=66 
GoogleCredential66 !
.66! "
FromFile66" *
(66* +
$str66+ C
)66C D
}77 
)77 
)77 
;77 
builder99 
.99 
Services99 
.99 
AddDbContext99 
<99 
AppDbContext99 *
>99* +
(99+ ,
options99, 3
=>994 6
{:: 
options;; 
.;; 
	UseNpgsql;; 
(;; 
builder;; 
.;; 
Configuration;; +
.;;+ ,
GetConnectionString;;, ?
(;;? @
$str;;@ P
);;P Q
);;Q R
;;;R S
}<< 
)<< 
;<< 
builder== 
.== 
Services== 
.== 
AddHostedService== !
<==! "
UserConsumer==" .
>==. /
(==/ 0
)==0 1
;==1 2
builder?? 
.?? 
Services?? 
.?? 
	AddScoped?? 
<?? 
IUserRepository?? *
,??* +
UserRepository??, :
>??: ;
(??; <
)??< =
;??= >
builder@@ 
.@@ 
Services@@ 
.@@ 
	AddScoped@@ 
<@@ 
IUserService@@ '
,@@' (
UserService@@) 4
>@@4 5
(@@5 6
)@@6 7
;@@7 8
varQQ 
appQQ 
=QQ 	
builderQQ
 
.QQ 
BuildQQ 
(QQ 
)QQ 
;QQ 
ifTT 
(TT 
appTT 
.TT 
EnvironmentTT 
.TT 
IsDevelopmentTT !
(TT! "
)TT" #
)TT# $
{UU 
appVV 
.VV 

UseSwaggerVV 
(VV 
)VV 
;VV 
appWW 
.WW 
UseSwaggerUIWW 
(WW 
)WW 
;WW 
}XX 
appZZ 
.ZZ 
UseHttpsRedirectionZZ 
(ZZ 
)ZZ 
;ZZ 
app[[ 
.[[ 
MapControllers[[ 
([[ 
)[[ 
;[[ 
app\\ 
.\\ 
Run\\ 
(\\ 
)\\ 	
;\\	 
¬:
ld:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\RabbitMQ\Consumer\UserConsumer.cs
	namespace 	
user_service
 
. 
Consumer 
{ 
public 

class 
UserConsumer 
: 
BackgroundService  1
{ 
private 
readonly 
ConnectionFactory *
_factory+ 3
;3 4
private 
readonly 
IServiceProvider )
_serviceProvider* :
;: ;
public 
UserConsumer 
( 
IServiceProvider ,
serviceProvider- <
)< =
{ 	
_serviceProvider 
= 
serviceProvider .
;. /
_factory 
= 
new 
ConnectionFactory ,
{ 
HostName 
= 
$str &
,& '"
DispatchConsumersAsync &
=' (
true) -
} 
; 
} 	
	protected 
override 
async  
Task! %
ExecuteAsync& 2
(2 3
CancellationToken3 D
stoppingTokenE R
)R S
{   	
Console!! 
.!! 
	WriteLine!! 
(!! 
$str!! <
)!!< =
;!!= >
using## 
var## 

connection##  
=##! "
_factory### +
.##+ ,
CreateConnection##, <
(##< =
)##= >
;##> ?
using$$ 
var$$ 
channel$$ 
=$$ 

connection$$  *
.$$* +
CreateModel$$+ 6
($$6 7
)$$7 8
;$$8 9
var&& 
queue&& 
=&& 
$str&& 
;&&  
channel'' 
.'' 
QueueDeclare''  
(''  !
queue(( 
:(( 
queue((  
,((  !
durable)) 
:)) 
false)) "
,))" #
	exclusive** 
:** 
false** $
,**$ %

autoDelete++ 
:++ 
false++  %
,++% &
	arguments,, 
:,, 
null,, #
),,# $
;,,$ %
channel-- 
.-- 
BasicQos-- 
(-- 
$num-- 
,-- 
$num--  !
,--! "
false--# (
)--( )
;--) *
var.. 
consumer.. 
=.. 
new.. &
AsyncEventingBasicConsumer.. 9
(..9 :
channel..: A
)..A B
;..B C
channel00 
.00 
BasicConsume00  
(00  !
queue00! &
:00& '
queue00( -
,00- .
autoAck00/ 6
:006 7
false008 =
,00= >
consumer00? G
:00G H
consumer00I Q
)00Q R
;00R S
consumer11 
.11 
Received11 
+=11  
async11! &
(11' (
model11( -
,11- .
ea11/ 1
)111 2
=>113 5
{22 
User33 
response33 
=33 
null33  $
;33$ %
var44 
body44 
=44 
ea44 
.44 
Body44 "
;44" #
var55 
props55 
=55 
ea55 
.55 
BasicProperties55 .
;55. /
var66 

replyProps66 
=66  
channel66! (
.66( )!
CreateBasicProperties66) >
(66> ?
)66? @
;66@ A

replyProps77 
.77 
CorrelationId77 (
=77) *
props77+ 0
.770 1
CorrelationId771 >
;77> ?
try88 
{99 
var:: 
message:: 
=::  !
Encoding::" *
.::* +
UTF8::+ /
.::/ 0
	GetString::0 9
(::9 :
body::: >
.::> ?
ToArray::? F
(::F G
)::G H
)::H I
;::I J
int;; 
n;; 
=;; 
int;; 
.;;  
Parse;;  %
(;;% &
message;;& -
);;- .
;;;. /
Console<< 
.<< 
	WriteLine<< %
(<<% &
$str<<& 9
,<<9 :
message<<; B
)<<B C
;<<C D
using== 
var== 
scope== #
===$ %
_serviceProvider==& 6
.==6 7
CreateScope==7 B
(==B C
)==C D
;==D E
var>> 
userService>> #
=>>$ %
scope>>& +
.>>+ ,
ServiceProvider>>, ;
.>>; <
GetRequiredService>>< N
<>>N O
IUserService>>O [
>>>[ \
(>>\ ]
)>>] ^
;>>^ _
var?? 
userDetails?? #
=??$ %
await??& +
userService??, 7
.??7 8
GetUser??8 ?
(??? @
n??@ A
)??A B
;??B C
response@@ 
=@@ 
userDetails@@ *
;@@* +
}AA 
catchBB 
(BB 
	ExceptionBB  
eBB! "
)BB" #
{CC 
ConsoleDD 
.DD 
	WriteLineDD %
(DD% &
$strDD& -
+DD. /
eDD0 1
.DD1 2
MessageDD2 9
)DD9 :
;DD: ;
responseEE 
=EE 
newEE "
UserEE# '
(EE' (
)EE( )
;EE) *
}FF 
finallyGG 
{HH 
varII 
responseBytesII %
=II& '
EncodingII( 0
.II0 1
UTF8II1 5
.II5 6
GetBytesII6 >
(II> ?
JsonSerializerII? M
.IIM N
	SerializeIIN W
(IIW X
responseIIX `
)II` a
)IIa b
;IIb c
channelJJ 
.JJ 
BasicPublishJJ (
(JJ( )
exchangeKK  
:KK  !
$strKK" $
,KK$ %

routingKeyLL "
:LL" #
propsLL$ )
.LL) *
ReplyToLL* 1
,LL1 2
basicPropertiesMM '
:MM' (

replyPropsMM) 3
,MM3 4
bodyNN 
:NN 
responseBytesNN +
)NN+ ,
;NN, -
channelOO 
.OO 
BasicAckOO $
(OO$ %
deliveryTagOO% 0
:OO0 1
eaOO2 4
.OO4 5
DeliveryTagOO5 @
,OO@ A
multipleOOB J
:OOJ K
falseOOL Q
)OOQ R
;OOR S
}PP 
}QQ 
;QQ 
awaitSS 
TaskSS 
.SS 
DelaySS 
(SS 
TimeoutSS $
.SS$ %
InfiniteSS% -
,SS- .
stoppingTokenSS/ <
)SS< =
;SS= >
}TT 	
publicVV 
overrideVV 
asyncVV 
TaskVV "
	StopAsyncVV# ,
(VV, -
CancellationTokenVV- >
cancellationTokenVV? P
)VVP Q
{WW 	
ConsoleXX 
.XX 
	WriteLineXX 
(XX 
$strXX <
)XX< =
;XX= >
awaitYY 
baseYY 
.YY 
	StopAsyncYY  
(YY  !
cancellationTokenYY! 2
)YY2 3
;YY3 4
}ZZ 	
}[[ 
}\\ ï
ld:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\RabbitMQ\Producer\UserProducer.cs
	namespace 	
user_service
 
. 
Producer 
{ 
public 

class 
UserProducer 
: 
BackgroundService  1
{ 
private 
readonly 
ConnectionFactory *
_factory+ 3
;3 4
private 
readonly 
IServiceProvider )
_serviceProvider* :
;: ;
private 
readonly 
IUserService %
_userService& 2
;2 3
public 
int 
userID 
; 
public 
UserProducer 
( 
IServiceProvider ,
serviceProvider- <
,< =
int> A
userIdB H
,H I
IUserServiceJ V
userServiceW b
)b c
{ 	
userID 
= 
userId 
; 
_serviceProvider 
= 
serviceProvider .
;. /
_factory 
= 
new 
ConnectionFactory ,
(, -
)- .
;. /
_factory 
. 
HostName 
= 
$str  +
;+ ,
_userService 
= 
userService &
;& '
}   	
	protected"" 
override"" 
async""  
Task""! %
ExecuteAsync""& 2
(""2 3
CancellationToken""3 D
stoppingToken""E R
)""R S
{## 	
using$$ 
var$$ 

connection$$  
=$$! "
_factory$$# +
.$$+ ,
CreateConnection$$, <
($$< =
)$$= >
;$$> ?
using%% 
var%% 
channel%% 
=%% 

connection%%  *
.%%* +
CreateModel%%+ 6
(%%6 7
)%%7 8
;%%8 9
User'' 
user'' 
='' 
await'' 
_userService'' *
.''* +
GetUser''+ 2
(''2 3
userID''3 9
)''9 :
;'': ;
var)) 
body)) 
=)) 
Encoding)) 
.))  
UTF8))  $
.))$ %
GetBytes))% -
())- .
user)). 2
.))2 3
ToString))3 ;
()); <
)))< =
)))= >
;))> ?
channel++ 
.++ 
BasicPublish++  
(++  !
exchange++! )
:++) *
$str+++ -
,++- .

routingKey,,! +
:,,+ ,
$str,,- :
,,,: ;
basicProperties--! 0
:--0 1
null--2 6
,--6 7
body..! %
:..% &
body..' +
)..+ ,
;.., -
Console00 
.00 
	WriteLine00 
(00 
$str00 -
,00- .
user00/ 3
)003 4
;004 5
await22 
Task22 
.22 
CompletedTask22 $
;22$ %
}33 	
}44 
}55 ∆	
sd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Repository\Interfaces\IUserRepository.cs
	namespace 	
user_service
 
. 

Repository !
.! "

Interfaces" ,
{ 
public		 

	interface		 
IUserRepository		 $
{

 
User 
GetUserByEmail 
( 
string "
email# (
)( )
;) *
Task 
< 
User 
> 
GetUser 
( 
int 
id !
)! "
;" #
User 

CreateUser 
( 
User 
user !
)! "
;" #
User 

UpdateUser 
( 
User 
user !
)! "
;" #
void 

DeleteUser 
( 
int 
id 
) 
;  
Task 
< 
IEnumerable 
< 
User 
> 
> 
GetAllUsers  +
(+ ,
), -
;- .
} 
} ¥'
gd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Repository\UserRepository.cs
	namespace

 	
user_service


 
.

 

Repository

 !
{ 
public 

class 
UserRepository 
:  !
IUserRepository" 1
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
UserRepository 
( 
AppDbContext *
context+ 2
)2 3
{ 	
_context 
= 
context 
; 
} 	
public 
User 

CreateUser 
( 
User #
user$ (
)( )
{ 	!
ArgumentNullException !
.! "
ThrowIfNull" -
(- .
user. 2
)2 3
;3 4
_context 
. 
Users 
. 
Add 
( 
user #
)# $
;$ %
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
user 
; 
} 	
public 
void 

DeleteUser 
( 
int "
id# %
)% &
{ 	
User 
user 
= 
_context  
.  !
Users! &
.& '
FirstOrDefault' 5
(5 6
u6 7
=>8 :
u; <
.< =
Id= ?
==@ B
idC E
)E F
;F G
if   
(   
user   
==   
null   
)   
{!! 
throw"" 
new"" !
ArgumentNullException"" /
(""/ 0
$str""0 @
)""@ A
;""A B
}## 
_context$$ 
.$$ 
Users$$ 
.$$ 
Remove$$ !
($$! "
user$$" &
)$$& '
;$$' (
}%% 	
public'' 
async'' 
Task'' 
<'' 
IEnumerable'' %
<''% &
User''& *
>''* +
>''+ ,
GetAllUsers''- 8
(''8 9
)''9 :
{(( 	
return)) 
await)) 
_context)) !
.))! "
Users))" '
.))' (
ToListAsync))( 3
())3 4
)))4 5
;))5 6
}** 	
public,, 
User,, 
GetUserByEmail,, "
(,," #
string,,# )
email,,* /
),,/ 0
{-- 	
return.. 
_context.. 
... 
Users.. !
...! "
FirstOrDefault.." 0
(..0 1
u..1 2
=>..3 5
u..6 7
...7 8
Email..8 =
==..> @
email..A F
)..F G
;..G H
}// 	
public11 
async11 
Task11 
<11 
User11 
>11 
GetUser11  '
(11' (
int11( +
id11, .
)11. /
{22 	
var33 
user33 
=33 
await33 
_context33 %
.33% &
Users33& +
.33+ ,
FirstOrDefaultAsync33, ?
(33? @
x33@ A
=>33B D
x33E F
.33F G
Id33G I
==33J L
id33M O
)33O P
;33P Q
if44 
(44 
user44 
==44 
null44 
)44 
{55 
throw66 
new66 
	Exception66 #
(66# $
$str66$ 4
)664 5
;665 6
}77 
return99 
user99 
;99 
};; 	
public== 
User== 

UpdateUser== 
(== 
User== #
user==$ (
)==( )
{>> 	
User?? 
userToUpdate?? 
=?? 
_context??  (
.??( )
Users??) .
.??. /
FirstOrDefault??/ =
(??= >
u??> ?
=>??@ B
u??C D
.??D E
Id??E G
==??H J
user??K O
.??O P
Id??P R
)??R S
;??S T
userToUpdate@@ 
.@@ 
Name@@ 
=@@ 
user@@  $
.@@$ %
Name@@% )
;@@) *
userToUpdateAA 
.AA 
GradeAA 
=AA  
userAA! %
.AA% &
GradeAA& +
;AA+ ,
userToUpdateBB 
.BB 
SchoolBB 
=BB  !
userBB" &
.BB& '
SchoolBB' -
;BB- .
_contextCC 
.CC 
UsersCC 
.CC 
UpdateCC !
(CC! "
userToUpdateCC" .
)CC. /
;CC/ 0
returnDD 
userToUpdateDD 
;DD  
}FF 	
}GG 
}HH Ç

cd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Services\IUserService.cs
	namespace 	
user_service
 
. 
Services 
{ 
public		 

	interface		 
IUserService		 !
{

 
public 
Task 
< 
IEnumerable 
<  
User  $
>$ %
>% &
GetAllUsers' 2
(2 3
)3 4
;4 5
public 
Task 
< 
User 
> 
GetUser !
(! "
int" %
id& (
)( )
;) *
public 
User 
GetUserByEmail "
(" #
string# )
email* /
)/ 0
;0 1
public 
User 

CreateUser 
( 
User #
user$ (
)( )
;) *
public 
User 

UpdateUser 
( 
User #
user$ (
)( )
;) *
public 
void 

DeleteUser 
( 
int "
id# %
)% &
;& '
} 
} õ
bd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Services\UserService.cs
	namespace 	
user_service
 
. 
Services 
{		 
public

 

class

 
UserService

 
:

 
IUserService

 +
{ 
private 
readonly 
IUserRepository (
_userRepository) 8
;8 9
public 
UserService 
( 
IUserRepository *
userRepository+ 9
)9 :
{ 	
_userRepository 
= 
userRepository ,
;, -
} 	
public 
User 

CreateUser 
( 
User #
user$ (
)( )
{ 	
return 
_userRepository "
." #

CreateUser# -
(- .
user. 2
)2 3
;3 4
} 	
public 
void 

DeleteUser 
( 
int "
id# %
)% &
{ 	
_userRepository 
. 

DeleteUser &
(& '
id' )
)) *
;* +
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
User& *
>* +
>+ ,
GetAllUsers- 8
(8 9
)9 :
{ 	
return 
await 
_userRepository (
.( )
GetAllUsers) 4
(4 5
)5 6
;6 7
} 	
public!! 
User!! 
GetUserByEmail!! "
(!!" #
string!!# )
email!!* /
)!!/ 0
{"" 	
return## 
_userRepository## "
.##" #
GetUserByEmail### 1
(##1 2
email##2 7
)##7 8
;##8 9
}$$ 	
public&& 
async&& 
Task&& 
<&& 
User&& 
>&& 
GetUser&&  '
(&&' (
int&&( +
id&&, .
)&&. /
{'' 	
return(( 
await(( 
_userRepository(( (
.((( )
GetUser(() 0
(((0 1
id((1 3
)((3 4
;((4 5
})) 	
public** 
User** 

UpdateUser** 
(** 
User** #
user**$ (
)**( )
{++ 	
return,, 
_userRepository,, "
.,," #

UpdateUser,,# -
(,,- .
user,,. 2
),,2 3
;,,3 4
}-- 	
}.. 
}// 