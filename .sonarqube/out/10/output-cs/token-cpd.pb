ƒ)
zd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Authentication\FirebaseAuthenticationHandler.cs
	namespace 	
user_service
 
. 
Authentication %
{ 
public 

class )
FirebaseAuthenticationHandler .
:/ 0!
AuthenticationHandler1 F
<F G'
AuthenticationSchemeOptionsG b
>b c
{ 
private 
readonly 
FirebaseApp $
_firebaseApp% 1
;1 2
public )
FirebaseAuthenticationHandler ,
(, -
IOptionsMonitor- <
<< ='
AuthenticationSchemeOptions= X
>X Y
optionsZ a
,a b
ILoggerFactoryc q
loggerr x
,x y

UrlEncoder	z Ñ
encoder
Ö å
,
å ç
ISystemClock
é ö
clock
õ †
,
† °
FirebaseApp
¢ ≠
firebaseApp
Æ π
)
π ∫
:
ª º
base
Ω ¡
(
¡ ¬
options
¬ …
,
…  
logger
À —
,
— “
encoder
” ⁄
,
⁄ €
clock
‹ ·
)
· ‚
{ 	
_firebaseApp 
= 
firebaseApp &
;& '
} 	
	protected 
override 
async  
Task! %
<% &
AuthenticateResult& 8
>8 9#
HandleAuthenticateAsync: Q
(Q R
)R S
{ 	
if 
( 
! 
Context 
. 
Request  
.  !
Headers! (
.( )
ContainsKey) 4
(4 5
$str5 D
)D E
)E F
{ 
return 
AuthenticateResult )
.) *
NoResult* 2
(2 3
)3 4
;4 5
} 
string 
bearerToken 
=  
Context! (
.( )
Request) 0
.0 1
Headers1 8
[8 9
$str9 H
]H I
;I J
if   
(   
bearerToken   
==   
null   #
||  $ &
!  ' (
bearerToken  ( 3
.  3 4

StartsWith  4 >
(  > ?
$str  ? H
)  H I
)  I J
{!! 
return"" 
AuthenticateResult"" )
."") *
Fail""* .
("". /
$str""/ M
)""M N
;""N O
}## 
string%% 
token%% 
=%% 
bearerToken%% &
.%%& '
	Substring%%' 0
(%%0 1
$str%%1 :
.%%: ;
Length%%; A
)%%A B
;%%B C
try'' 
{(( 
FirebaseToken)) 
firebaseToken)) +
=)), -
await)). 3
FirebaseAuth))4 @
.))@ A
GetAuth))A H
())H I
_firebaseApp))I U
)))U V
.))V W
VerifyIdTokenAsync))W i
())i j
token))j o
)))o p
;))p q
return-- 
AuthenticateResult-- )
.--) *
Success--* 1
(--1 2
new--2 5 
AuthenticationTicket--6 J
(--J K
new--K N
ClaimsPrincipal--O ^
(--^ _
new--_ b
List--c g
<--g h
ClaimsIdentity--h v
>--v w
{--w x
new.. 
ClaimsIdentity.. "
(.." #
ToClaims..# +
(..+ ,
firebaseToken.., 9
...9 :
Claims..: @
)..@ A
,..A B
nameof..C I
(..I J)
FirebaseAuthenticationHandler..J g
)..g h
)..h i
}// 
)// 
,// 
JwtBearerDefaults// !
.//! " 
AuthenticationScheme//" 6
)//6 7
)//7 8
;//8 9
}00 
catch11 
(11 
	Exception11 
e11 
)11 
{22 
return33 
AuthenticateResult33 )
.33) *
Fail33* .
(33. /
e33/ 0
.330 1
Message331 8
)338 9
;339 :
}44 
}77 	
private99 
IEnumerable99 
<99 
Claim99 !
>99! "
ToClaims99# +
(99+ ,
IReadOnlyDictionary99, ?
<99? @
string99@ F
,99F G
object99H N
>99N O
claims99P V
)99V W
{:: 	
return;; 
new;; 
List;; 
<;; 
Claim;; !
>;;! "
{<< 
new== 
Claim== 
(== 
$str== 
,== 
claims==  &
[==& '
$str==' 0
]==0 1
.==1 2
ToString==2 :
(==: ;
)==; <
)==< =
,=== >
new>> 
Claim>> 
(>> 
$str>> !
,>>! "
claims>># )
[>>) *
$str>>* 1
]>>1 2
.>>2 3
ToString>>3 ;
(>>; <
)>>< =
)>>= >
,>>> ?
}@@ 
;@@ 
}AA 	
}BB 
}CC èl
hd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Controllers\UserController.cs
	namespace 	
user_service
 
. 
Controllers "
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IUserService %
_userService& 2
;2 3
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserController 
( 
IUserService *
userService+ 6
,6 7
IMapper8 ?
mapper@ F
)F G
{ 	
_userService 
= 
userService &
;& '
_mapper 
= 
mapper 
; 
} 	
[ 	
	Authorize	 
] 
[ 	
HttpGet	 
( 
$str 
) 
] 
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
GetAll!!) /
(!!/ 0
)!!0 1
{"" 	
var## 
users## 
=## 
await## 
_userService## *
.##* +
GetAllUsers##+ 6
(##6 7
)##7 8
;##8 9
return$$ 
Ok$$ 
($$ 
_mapper$$ 
.$$ 
Map$$ !
<$$! "
IEnumerable$$" -
<$$- .
UserDto$$. 5
>$$5 6
>$$6 7
($$7 8
users$$8 =
)$$= >
)$$> ?
;$$? @
}%% 	
['' 	
	Authorize''	 
]'' 
[(( 	
HttpGet((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
ActionResult)) &
<))& '
UserDto))' .
>)). /
>))/ 0
GetUserById))1 <
())< =
int))= @
id))A C
)))C D
{** 	
var++ 
user++ 
=++ 
await++ 
_userService++ )
.++) *
GetUser++* 1
(++1 2
id++2 4
)++4 5
;++5 6
if,, 
(,, 
user,, 
==,, 
null,, 
),, 
{-- 
return.. 
NotFound.. 
(..  
)..  !
;..! "
}// 
return00 
Ok00 
(00 
_mapper00 
.00 
Map00 !
<00! "
UserDto00" )
>00) *
(00* +
user00+ /
)00/ 0
)000 1
;001 2
}11 	
[33 	
	Authorize33	 
]33 
[44 	
HttpGet44	 
(44 
$str44  
)44  !
]44! "
public55 
ActionResult55 
<55 
UserDto55 #
>55# $
GetUserByEmail55% 3
(553 4
string554 :
email55; @
)55@ A
{66 	
var77 
user77 
=77 
_userService77 #
.77# $
GetUserByEmail77$ 2
(772 3
email773 8
)778 9
;779 :
if88 
(88 
user88 
==88 
null88 
)88 
{99 
return:: 
NotFound:: 
(::  
)::  !
;::! "
};; 
return<< 
Ok<< 
(<< 
_mapper<< 
.<< 
Map<< !
<<<! "
UserDto<<" )
><<) *
(<<* +
user<<+ /
)<</ 0
)<<0 1
;<<1 2
}== 	
[?? 	
HttpPost??	 
(?? 
$str?? 
)?? 
]?? 
public@@ 
ActionResult@@ 
<@@ 
UserDto@@ #
>@@# $

CreateUser@@% /
(@@/ 0
[@@0 1
FromBody@@1 9
]@@9 :
CreateUserDto@@; H
userDto@@I P
)@@P Q
{AA 	
ifBB 
(BB 
!BB 

ModelStateBB 
.BB 
IsValidBB #
)BB# $
{CC 
returnDD 

BadRequestDD !
(DD! "

ModelStateDD" ,
)DD, -
;DD- .
}EE 
ifGG 
(GG 
!GG 
EnumGG 
.GG 
TryParseGG 
(GG 
userDtoGG &
.GG& '
GradeGG' ,
,GG, -
outGG. 1
GradeGG2 7
gradeGG8 =
)GG= >
)GG> ?
{HH 
returnII 

BadRequestII !
(II! "
$strII" 8
)II8 9
;II9 :
}JJ 
varLL 
userArgsLL 
=LL 
newLL 
UserRecordArgsLL -
(LL- .
)LL. /
{MM 
EmailNN 
=NN 
userDtoNN 
.NN  
EmailNN  %
,NN% &
EmailVerifiedOO 
=OO 
falseOO  %
,OO% &
PasswordPP 
=PP 
userDtoPP "
.PP" #
PasswordPP# +
,PP+ ,
DisplayNameQQ 
=QQ 
userDtoQQ %
.QQ% &
NameQQ& *
,QQ* +
DisabledRR 
=RR 
falseRR  
}SS 
;SS 
varUU 

userRecordUU 
=UU 
FirebaseAuthUU )
.UU) *
DefaultInstanceUU* 9
.UU9 :
CreateUserAsyncUU: I
(UUI J
userArgsUUJ R
)UUR S
;UUS T
ifXX 
(XX 

userRecordXX 
.XX 
ResultXX !
==XX" $
nullXX% )
)XX) *
{YY 
returnZZ 

BadRequestZZ !
(ZZ! "
$strZZ" 9
)ZZ9 :
;ZZ: ;
}[[ 
var^^ 
user^^ 
=^^ 
new^^ 
User^^ 
{__ 
Name`` 
=`` 
userDto`` 
.`` 
Name`` #
,``# $
Emailaa 
=aa 
userDtoaa 
.aa  
Emailaa  %
,aa% &
Gradebb 
=bb 
gradebb 
,bb 
Schoolcc 
=cc 
userDtocc  
.cc  !
Schoolcc! '
,cc' (
Roledd 
=dd 
Roledd 
.dd 
Userdd  
}ee 
;ee 
_userServiceff 
.ff 

CreateUserff #
(ff# $
userff$ (
)ff( )
;ff) *
returngg 
CreatedAtActiongg "
(gg" #
nameofgg# )
(gg) *
GetUserByIdgg* 5
)gg5 6
,gg6 7
newgg8 ;
{gg< =
idgg> @
=ggA B
userggC G
.ggG H
IdggH J
}ggK L
,ggL M
userggN R
)ggR S
;ggS T
}hh 	
[jj 	
	Authorizejj	 
]jj 
[kk 	
HttpPostkk	 
(kk 
$strkk 
)kk 
]kk 
publicmm 
ActionResultmm 
<mm 
UserDtomm #
>mm# $
CreateAdminmm% 0
(mm0 1
[mm1 2
FromBodymm2 :
]mm: ;
CreateAdminDtomm< J
userDtommK R
)mmR S
{nn 	
ifoo 
(oo 
!oo 

ModelStateoo 
.oo 
IsValidoo #
)oo# $
{pp 
returnqq 

BadRequestqq !
(qq! "

ModelStateqq" ,
)qq, -
;qq- .
}rr 
vartt 
usertt 
=tt 
newtt 
Usertt 
{uu 
Namevv 
=vv 
userDtovv 
.vv 
Namevv #
,vv# $
Emailww 
=ww 
userDtoww 
.ww  
Emailww  %
,ww% &
Gradexx 
=xx 
Gradexx 
.xx 
Unknownxx %
,xx% &
Schoolyy 
=yy 
nullyy 
!yy 
,yy 
Rolezz 
=zz 
Rolezz 
.zz 
Adminzz !
}{{ 
;{{ 
_userService|| 
.|| 

CreateUser|| #
(||# $
user||$ (
)||( )
;||) *
return}} 
CreatedAtAction}} "
(}}" #
nameof}}# )
(}}) *
GetUserById}}* 5
)}}5 6
,}}6 7
new}}8 ;
{}}< =
id}}> @
=}}A B
user}}C G
.}}G H
Id}}H J
}}}K L
,}}L M
user}}N R
)}}R S
;}}S T
}~~ 	
[ 	
	Authorize	 
] 
[
ÄÄ 	
HttpPut
ÄÄ	 
(
ÄÄ 
$str
ÄÄ 
)
ÄÄ 
]
ÄÄ 
public
ÅÅ 
async
ÅÅ 
Task
ÅÅ 
<
ÅÅ 
ActionResult
ÅÅ &
<
ÅÅ& '
UserDto
ÅÅ' .
>
ÅÅ. /
>
ÅÅ/ 0

UpdateUser
ÅÅ1 ;
(
ÅÅ; <
[
ÅÅ< =
	FromRoute
ÅÅ= F
]
ÅÅF G
int
ÅÅH K
id
ÅÅL N
,
ÅÅN O
[
ÅÅP Q
FromBody
ÅÅQ Y
]
ÅÅY Z
UpdateUserDto
ÅÅ[ h
userDto
ÅÅi p
)
ÅÅp q
{
ÇÇ 	
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 

ModelState
ÉÉ 
.
ÉÉ 
IsValid
ÉÉ #
)
ÉÉ# $
{
ÑÑ 
return
ÖÖ 

BadRequest
ÖÖ !
(
ÖÖ! "

ModelState
ÖÖ" ,
)
ÖÖ, -
;
ÖÖ- .
}
ÜÜ 
if
àà 
(
àà 
!
àà 
Enum
àà 
.
àà 
TryParse
àà 
(
àà 
userDto
àà &
.
àà& '
Grade
àà' ,
,
àà, -
out
àà. 1
Grade
àà2 7
grade
àà8 =
)
àà= >
)
àà> ?
{
ââ 
return
ãã 

BadRequest
ãã !
(
ãã! "
$str
ãã" 8
)
ãã8 9
;
ãã9 :
}
åå 
var
éé 
user
éé 
=
éé 
await
éé 
_userService
éé )
.
éé) *
GetUser
éé* 1
(
éé1 2
id
éé2 4
)
éé4 5
;
éé5 6
if
èè 
(
èè 
user
èè 
==
èè 
null
èè 
)
èè 
{
êê 
return
ëë 
NotFound
ëë 
(
ëë  
)
ëë  !
;
ëë! "
}
íí 
user
îî 
.
îî 
Name
îî 
=
îî 
userDto
îî 
.
îî  
Name
îî  $
;
îî$ %
user
ïï 
.
ïï 
Grade
ïï 
=
ïï 
grade
ïï 
;
ïï 
user
ññ 
.
ññ 
School
ññ 
=
ññ 
userDto
ññ !
.
ññ! "
School
ññ" (
;
ññ( )
_userService
óó 
.
óó 

UpdateUser
óó #
(
óó# $
user
óó$ (
)
óó( )
;
óó) *
return
ôô 
Ok
ôô 
(
ôô 
_mapper
ôô 
.
ôô 
Map
ôô !
<
ôô! "
UserDto
ôô" )
>
ôô) *
(
ôô* +
user
ôô+ /
)
ôô/ 0
)
ôô0 1
;
ôô1 2
}
öö 	
[
úú 	
	Authorize
úú	 
]
úú 
[
ùù 	

HttpDelete
ùù	 
(
ùù 
$str
ùù 
)
ùù 
]
ùù  
public
ûû 
async
ûû 
Task
ûû 
<
ûû 
ActionResult
ûû &
>
ûû& '

DeleteUser
ûû( 2
(
ûû2 3
int
ûû3 6
id
ûû7 9
)
ûû9 :
{
üü 	
var
†† 
user
†† 
=
†† 
await
†† 
_userService
†† )
.
††) *
GetUser
††* 1
(
††1 2
id
††2 4
)
††4 5
;
††5 6
if
°° 
(
°° 
user
°° 
==
°° 
null
°° 
)
°° 
{
¢¢ 
return
££ 
NotFound
££ 
(
££  
)
££  !
;
££! "
}
§§ 
_userService
•• 
.
•• 

DeleteUser
•• #
(
••# $
id
••$ &
)
••& '
;
••' (

UserRecord
®® 

userRecord
®® !
=
®®" #
await
®®$ )
FirebaseAuth
®®* 6
.
®®6 7
DefaultInstance
®®7 F
.
®®F G!
GetUserByEmailAsync
®®G Z
(
®®Z [
user
®®[ _
.
®®_ `
Email
®®` e
)
®®e f
;
®®f g
if
™™ 
(
™™ 

userRecord
™™ 
==
™™ 
null
™™ "
)
™™" #
{
´´ 
return
¨¨ 
NotFound
¨¨ 
(
¨¨  
)
¨¨  !
;
¨¨! "
}
≠≠ 
await
ØØ 
FirebaseAuth
ØØ 
.
ØØ 
DefaultInstance
ØØ .
.
ØØ. /
DeleteUserAsync
ØØ/ >
(
ØØ> ?

userRecord
ØØ? I
.
ØØI J
Uid
ØØJ M
)
ØØM N
;
ØØN O
return
≤≤ 
Ok
≤≤ 
(
≤≤ 
_mapper
≤≤ 
.
≤≤ 
Map
≤≤ !
<
≤≤! "
UserDto
≤≤" )
>
≤≤) *
(
≤≤* +
user
≤≤+ /
)
≤≤/ 0
)
≤≤0 1
;
≤≤1 2
}
≥≥ 	
}
√√ 
}ƒƒ ⁄
_d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Data\AppDbContext.cs
	namespace 	
user_service
 
. 
Data 
{ 
public 

class 
AppDbContext 
: 
	DbContext  )
{ 
	protected		 
readonly		 
IConfiguration		 )
Configuration		* 7
;		7 8
public 
AppDbContext 
( 
IConfiguration *
configuration+ 8
)8 9
{ 	
Configuration 
= 
configuration )
;) *
} 	
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
optionsBuilder 
. 
	UseNpgsql $
($ %
Configuration% 2
.2 3
GetConnectionString3 F
(F G
$strG W
)W X
)X Y
;Y Z
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
. 
Property 
( 
u 
=> 
u  
.  !
Role! %
)% &
. 
HasConversion 
< 
string %
>% &
(& '
)' (
;( )
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
. 
Property 
( 
u 
=> 
u  
.  !
Grade! &
)& '
. 
HasConversion 
< 
string %
>% &
(& '
)' (
;( )
} 	
}   
}!! Æ
ad:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\CreateAdminDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
CreateAdminDto		 
{

 
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str E
,E F
ErrorMessageG S
=T U
$str	V ≤
)
≤ ≥
]
≥ ¥
[ 	
	MinLength	 
( 
$num 
, 
ErrorMessage "
=# $
$str% S
)S T
]T U
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
null/ 3
!3 4
;4 5
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< ]
)] ^
]^ _
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
} 
} ≈
`d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\CreateUserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
CreateUserDto		 
{

 
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str E
,E F
ErrorMessageG S
=T U
$str	V ≤
)
≤ ≥
]
≥ ¥
[ 	
	MinLength	 
( 
$num 
, 
ErrorMessage "
=# $
$str% S
)S T
]T U
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
null/ 3
!3 4
;4 5
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< ]
)] ^
]^ _
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
[ 	
Required	 
] 
public 
string 
Grade 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
} 
}   Ë	
_d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\LoginUserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
LoginUserDto		 
{

 
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
[ 	
RegularExpression	 
( 
$str E
,E F
ErrorMessageG S
=T U
$str	V ≤
)
≤ ≥
]
≥ ¥
[ 	
	MinLength	 
( 
$num 
, 
ErrorMessage "
=# $
$str% S
)S T
]T U
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
null/ 3
!3 4
;4 5
} 
} Î
`d:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\UpdateUserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
UpdateUserDto		 
{

 
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< ]
)] ^
]^ _
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 
string 
Grade 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
} 
} È

Zd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Dtos\UserDto.cs
	namespace 	
user_service
 
. 
Dtos 
{ 
public		 

class		 
UserDto		 
{

 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 
Grade 
Grade 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
public 
Role 
Role 
{ 
get 
; 
set  #
;# $
}% &
} 
} ü
ld:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Migrations\20240315121037_init.cs
	namespace 	
user_service
 
. 

Migrations !
{ 
public		 

partial		 
class		 
init		 
:		 
	Migration		  )
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ D
,D E)
NpgsqlValueGenerationStrategyF c
.c d#
IdentityByDefaultColumnd {
){ |
,| }
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
Password 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Grade 
= 
table !
.! "
Column" (
<( )
int) ,
>, -
(- .
type. 2
:2 3
$str4 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
School 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
Role 
= 
table  
.  !
Column! '
<' (
int( +
>+ ,
(, -
type- 1
:1 2
$str3 <
,< =
nullable> F
:F G
falseH M
)M N
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
} 	
	protected"" 
override"" 
void"" 
Down""  $
(""$ %
MigrationBuilder""% 5
migrationBuilder""6 F
)""F G
{## 	
migrationBuilder$$ 
.$$ 
	DropTable$$ &
($$& '
name%% 
:%% 
$str%% 
)%% 
;%% 
}&& 	
}'' 
}(( ¢
yd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Migrations\20240315152832_enumstringconvert.cs
	namespace 	
user_service
 
. 

Migrations !
{ 
public 

partial 
class 
enumstringconvert *
:+ ,
	Migration- 6
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
)" #
;# $
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
)" #
;# $
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{   	
migrationBuilder!! 
.!! 
AlterColumn!! (
<!!( )
int!!) ,
>!!, -
(!!- .
name"" 
:"" 
$str"" 
,"" 
table## 
:## 
$str## 
,## 
type$$ 
:$$ 
$str$$ 
,$$  
nullable%% 
:%% 
false%% 
,%%  

oldClrType&& 
:&& 
typeof&& "
(&&" #
string&&# )
)&&) *
,&&* +
oldType'' 
:'' 
$str'' 
)''  
;''  !
migrationBuilder)) 
.)) 
AlterColumn)) (
<))( )
int))) ,
>)), -
())- .
name** 
:** 
$str** 
,** 
table++ 
:++ 
$str++ 
,++ 
type,, 
:,, 
$str,, 
,,,  
nullable-- 
:-- 
false-- 
,--  

oldClrType.. 
:.. 
typeof.. "
(.." #
string..# )
)..) *
,..* +
oldType// 
:// 
$str// 
)//  
;//  !
}00 	
}11 
}22 Ë
vd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Migrations\20240315170748_removepassword.cs
	namespace 	
user_service
 
. 

Migrations !
{ 
public 

partial 
class 
removepassword '
:( )
	Migration* 3
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str  
,  !
table 
: 
$str 
) 
;  
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str  
,  !
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
} 	
} 
} ¡
Yd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Model\Grade.cs
	namespace 	
user_service
 
. 
Model 
{ 
public 

enum 
Grade 
{ 

Elementary 
, 
Middle 
, 
High  
,  !
College" )
,) *
Unknown+ 2
} 
} œ
Xd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Model\Role.cs
	namespace 	
user_service
 
. 
Model 
{ 
public 

enum 
Role 
{ 
User 
, 
Admin 
} 
} ò
Xd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Model\User.cs
	namespace 	
user_service
 
. 
model 
{		 
public

 

class

 
User

 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
[ 	
Required	 
] 
public 
Grade 
Grade 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
public 
string 
School 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
[ 	
Required	 
] 
public 
Role 
Role 
{ 
get 
; 
set  #
;# $
}% &
} 
}   õ
dd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Profile\MappingProfile.cs
	namespace		 	
user_service		
 
.		 
Profile		 
{

 
public 

class 
MappingProfile 
:  !

AutoMapper" ,
., -
Profile- 4
{ 
public 
MappingProfile 
( 
) 
{ 	
	CreateMap 
< 
User 
, 
UserDto #
># $
($ %
)% &
;& '
	CreateMap 
< 
UserDto 
, 
User #
># $
($ %
)% &
;& '
} 	
} 
} í1
Ud:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
.! "
AddJsonOptions" 0
(0 1
options1 8
=>9 ;
options 
. 	!
JsonSerializerOptions	 
. 

Converters )
.) *
Add* -
(- .
new. 1#
JsonStringEnumConverter2 I
(I J
)J K
)K L
)L M
;M N
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddAutoMapper 
( 
typeof %
(% &
Program& -
)- .
). /
;/ 0
builder 
. 
Services 
. 
AddAuthentication "
(" #
JwtBearerDefaults# 4
.4 5 
AuthenticationScheme5 I
)I J
.J K
	AddSchemeK T
<T U'
AuthenticationSchemeOptionsU p
,p q*
FirebaseAuthenticationHandler	r è
>
è ê
(
ê ë
JwtBearerDefaults
ë ¢
.
¢ £"
AuthenticationScheme
£ ∑
,
∑ ∏
(
π ∫
o
∫ ª
)
ª º
=>
Ω ø
{
¿ ¡
}
¬ √
)
√ ƒ
;
ƒ ≈
builder 
. 
Services 
. 
AddSwaggerGen 
( 
option %
=>& (
{ 
option 

.
 

SwaggerDoc 
( 
$str 
, 
new 
OpenApiInfo  +
{, -
Title. 3
=4 5
$str6 @
,@ A
VersionB I
=J K
$strL P
}Q R
)R S
;S T
option 

.
 !
AddSecurityDefinition  
(  !
$str! )
,) *
new+ .!
OpenApiSecurityScheme/ D
{ 
In 

= 
ParameterLocation 
. 
Header %
,% &
Description 
= 
$str 2
,2 3
Name   
=   
$str   
,   
Type!! 
=!! 
SecuritySchemeType!! !
.!!! "
Http!!" &
,!!& '
BearerFormat"" 
="" 
$str"" 
,"" 
Scheme## 
=## 
$str## 
}$$ 
)$$ 
;$$ 
option%% 

.%%
 "
AddSecurityRequirement%% !
(%%! "
new%%" %&
OpenApiSecurityRequirement%%& @
{&& 
{'' 	
new(( !
OpenApiSecurityScheme(( %
{)) 
	Reference** 
=** 
new** 
OpenApiReference**  0
{++ 
Type,, 
=,, 
ReferenceType,, &
.,,& '
SecurityScheme,,' 5
,,,5 6
Id-- 
=-- 
$str-- 
}.. 
}// 
,// 
new00 
string00 
[00 
]00 
{00 
}00 
}11 	
}22 
)22 
;22 
}33 
)33 
;33 
builder44 
.44 
Services44 
.44 
AddSingleton44 
(44 
FirebaseApp44 )
.44) *
Create44* 0
(440 1
new441 4

AppOptions445 ?
(44? @
)44@ A
{55 

Credential66 
=66 
GoogleCredential66 !
.66! "
FromFile66" *
(66* +
$str66+ C
)66C D
}77 
)77 
)77 
;77 
builder99 
.99 
Services99 
.99 
AddDbContext99 
<99 
AppDbContext99 *
>99* +
(99+ ,
options99, 3
=>994 6
{:: 
options;; 
.;; 
	UseNpgsql;; 
(;; 
builder;; 
.;; 
Configuration;; +
.;;+ ,
GetConnectionString;;, ?
(;;? @
$str;;@ P
);;P Q
);;Q R
;;;R S
}<< 
)<< 
;<< 
builder== 
.== 
Services== 
.== 
AddHostedService== !
<==! "
UserConsumer==" .
>==. /
(==/ 0
)==0 1
;==1 2
builder?? 
.?? 
Services?? 
.?? 
	AddScoped?? 
<?? 
IUserRepository?? *
,??* +
UserRepository??, :
>??: ;
(??; <
)??< =
;??= >
builder@@ 
.@@ 
Services@@ 
.@@ 
	AddScoped@@ 
<@@ 
IUserService@@ '
,@@' (
UserService@@) 4
>@@4 5
(@@5 6
)@@6 7
;@@7 8
varQQ 
appQQ 
=QQ 	
builderQQ
 
.QQ 
BuildQQ 
(QQ 
)QQ 
;QQ 
ifTT 
(TT 
appTT 
.TT 
EnvironmentTT 
.TT 
IsDevelopmentTT !
(TT! "
)TT" #
)TT# $
{UU 
appVV 
.VV 

UseSwaggerVV 
(VV 
)VV 
;VV 
appWW 
.WW 
UseSwaggerUIWW 
(WW 
)WW 
;WW 
}XX 
appZZ 
.ZZ 
UseHttpsRedirectionZZ 
(ZZ 
)ZZ 
;ZZ 
app[[ 
.[[ 
MapControllers[[ 
([[ 
)[[ 
;[[ 
app\\ 
.\\ 
Run\\ 
(\\ 
)\\ 	
;\\	 
Åt
ld:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\RabbitMQ\Consumer\UserConsumer.cs
	namespace 	
user_service
 
. 
Consumer 
{ 
public 

class 
UserConsumer 
: 
BackgroundService  1
{ 
private 
readonly 
ConnectionFactory *
_factory+ 3
;3 4
private 
readonly 
IServiceProvider )
_serviceProvider* :
;: ;
string 
key 
= 
$str C
;C D
string 
iv 
= 
$str .
;. /
public 
UserConsumer 
( 
IServiceProvider ,
serviceProvider- <
)< =
{ 	
_serviceProvider 
= 
serviceProvider .
;. /
_factory 
= 
new 
ConnectionFactory ,
{ 
HostName 
= 
$str &
,& '"
DispatchConsumersAsync &
=' (
true) -
}   
;   
}!! 	
	protected## 
override## 
async##  
Task##! %
ExecuteAsync##& 2
(##2 3
CancellationToken##3 D
stoppingToken##E R
)##R S
{$$ 	
Console%% 
.%% 
	WriteLine%% 
(%% 
$str%% <
)%%< =
;%%= >
using'' 
var'' 

connection''  
=''! "
_factory''# +
.''+ ,
CreateConnection'', <
(''< =
)''= >
;''> ?
using(( 
var(( 
channel(( 
=(( 

connection((  *
.((* +
CreateModel((+ 6
(((6 7
)((7 8
;((8 9
var** 
queue** 
=** 
$str** 
;**  
channel++ 
.++ 
QueueDeclare++  
(++  !
queue,, 
:,, 
queue,,  
,,,  !
durable-- 
:-- 
false-- "
,--" #
	exclusive.. 
:.. 
false.. $
,..$ %

autoDelete// 
:// 
false//  %
,//% &
	arguments00 
:00 
null00 #
)00# $
;00$ %
channel11 
.11 
BasicQos11 
(11 
$num11 
,11 
$num11  !
,11! "
false11# (
)11( )
;11) *
var22 
consumer22 
=22 
new22 &
AsyncEventingBasicConsumer22 9
(229 :
channel22: A
)22A B
;22B C
channel44 
.44 
BasicConsume44  
(44  !
queue44! &
:44& '
queue44( -
,44- .
autoAck44/ 6
:446 7
false448 =
,44= >
consumer44? G
:44G H
consumer44I Q
)44Q R
;44R S
consumer55 
.55 
Received55 
+=55  
async55! &
(55' (
model55( -
,55- .
ea55/ 1
)551 2
=>553 5
{66 
User77 
response77 
=77 
null77  $
;77$ %
var88 
body88 
=88 
ea88 
.88 
Body88 "
;88" #
var99 
props99 
=99 
ea99 
.99 
BasicProperties99 .
;99. /
var:: 

replyProps:: 
=::  
channel::! (
.::( )!
CreateBasicProperties::) >
(::> ?
)::? @
;::@ A

replyProps;; 
.;; 
CorrelationId;; (
=;;) *
props;;+ 0
.;;0 1
CorrelationId;;1 >
;;;> ?
try<< 
{== 
string>> 
message>> "
=>># $&
DecryptStringFromBytes_Aes>>% ?
(>>? @
body>>@ D
.>>D E
ToArray>>E L
(>>L M
)>>M N
,>>N O
Convert>>P W
.>>W X
FromBase64String>>X h
(>>h i
key>>i l
)>>l m
,>>m n
Convert>>o v
.>>v w
FromBase64String	>>w á
(
>>á à
iv
>>à ä
)
>>ä ã
)
>>ã å
;
>>å ç
intAA 
nAA 
=AA 
intAA 
.AA  
ParseAA  %
(AA% &
messageAA& -
)AA- .
;AA. /
usingCC 
varCC 
scopeCC #
=CC$ %
_serviceProviderCC& 6
.CC6 7
CreateScopeCC7 B
(CCB C
)CCC D
;CCD E
varDD 
userServiceDD #
=DD$ %
scopeDD& +
.DD+ ,
ServiceProviderDD, ;
.DD; <
GetRequiredServiceDD< N
<DDN O
IUserServiceDDO [
>DD[ \
(DD\ ]
)DD] ^
;DD^ _
varEE 
userDetailsEE #
=EE$ %
awaitEE& +
userServiceEE, 7
.EE7 8
GetUserEE8 ?
(EE? @
nEE@ A
)EEA B
;EEB C
responseFF 
=FF 
userDetailsFF *
;FF* +
}GG 
catchHH 
(HH 
	ExceptionHH  
eHH! "
)HH" #
{II 
ConsoleJJ 
.JJ 
	WriteLineJJ %
(JJ% &
$strJJ& -
+JJ. /
eJJ0 1
.JJ1 2
MessageJJ2 9
)JJ9 :
;JJ: ;
responseKK 
=KK 
newKK "
UserKK# '
(KK' (
)KK( )
;KK) *
}MM 
finallyNN 
{OO 
varRR 
responseBytesRR %
=RR& '$
EncryptStringToBytes_AesRR( @
(RR@ A
JsonSerializerRRA O
.RRO P
	SerializeRRP Y
(RRY Z
responseRRZ b
)RRb c
,RRc d
ConvertRRe l
.RRl m
FromBase64StringRRm }
(RR} ~
key	RR~ Å
)
RRÅ Ç
,
RRÇ É
Convert
RRÑ ã
.
RRã å
FromBase64String
RRå ú
(
RRú ù
iv
RRù ü
)
RRü †
)
RR† °
;
RR° ¢
channelSS 
.SS 
BasicPublishSS (
(SS( )
exchangeTT  
:TT  !
$strTT" $
,TT$ %

routingKeyUU "
:UU" #
propsUU$ )
.UU) *
ReplyToUU* 1
,UU1 2
basicPropertiesVV '
:VV' (

replyPropsVV) 3
,VV3 4
bodyWW 
:WW 
responseBytesWW +
)WW+ ,
;WW, -
channelXX 
.XX 
BasicAckXX $
(XX$ %
deliveryTagXX% 0
:XX0 1
eaXX2 4
.XX4 5
DeliveryTagXX5 @
,XX@ A
multipleXXB J
:XXJ K
falseXXL Q
)XXQ R
;XXR S
}YY 
}ZZ 
;ZZ 
await\\ 
Task\\ 
.\\ 
Delay\\ 
(\\ 
Timeout\\ $
.\\$ %
Infinite\\% -
,\\- .
stoppingToken\\/ <
)\\< =
;\\= >
}]] 	
public__ 
override__ 
async__ 
Task__ "
	StopAsync__# ,
(__, -
CancellationToken__- >
cancellationToken__? P
)__P Q
{`` 	
Consoleaa 
.aa 
	WriteLineaa 
(aa 
$straa <
)aa< =
;aa= >
awaitbb 
basebb 
.bb 
	StopAsyncbb  
(bb  !
cancellationTokenbb! 2
)bb2 3
;bb3 4
}cc 	
staticee 
byteee 
[ee 
]ee $
EncryptStringToBytes_Aesee .
(ee. /
stringee/ 5
	plainTextee6 ?
,ee? @
byteeeA E
[eeE F
]eeF G
KeyeeH K
,eeK L
byteeeM Q
[eeQ R
]eeR S
IVeeT V
)eeV W
{ff 	
ifhh 
(hh 
	plainTexthh 
==hh 
nullhh !
||hh" $
	plainTexthh% .
.hh. /
Lengthhh/ 5
<=hh6 8
$numhh9 :
)hh: ;
throwii 
newii !
ArgumentNullExceptionii /
(ii/ 0
$strii0 ;
)ii; <
;ii< =
ifjj 
(jj 
Keyjj 
==jj 
nulljj 
||jj 
Keyjj "
.jj" #
Lengthjj# )
<=jj* ,
$numjj- .
)jj. /
throwkk 
newkk !
ArgumentNullExceptionkk /
(kk/ 0
$strkk0 5
)kk5 6
;kk6 7
ifll 
(ll 
IVll 
==ll 
nullll 
||ll 
IVll  
.ll  !
Lengthll! '
<=ll( *
$numll+ ,
)ll, -
throwmm 
newmm !
ArgumentNullExceptionmm /
(mm/ 0
$strmm0 4
)mm4 5
;mm5 6
bytenn 
[nn 
]nn 
	encryptednn 
;nn 
usingqq 
(qq 
Aesqq 
aesAlgqq 
=qq 
Aesqq  #
.qq# $
Createqq$ *
(qq* +
)qq+ ,
)qq, -
{rr 
aesAlgss 
.ss 
Keyss 
=ss 
Keyss  
;ss  !
aesAlgtt 
.tt 
IVtt 
=tt 
IVtt 
;tt 
ICryptoTransformvv  
	encryptorvv! *
=vv+ ,
aesAlgvv- 3
.vv3 4
CreateEncryptorvv4 C
(vvC D
aesAlgvvD J
.vvJ K
KeyvvK N
,vvN O
aesAlgvvP V
.vvV W
IVvvW Y
)vvY Z
;vvZ [
usingxx 
(xx 
MemoryStreamxx #
	msEncryptxx$ -
=xx. /
newxx0 3
MemoryStreamxx4 @
(xx@ A
)xxA B
)xxB C
{yy 
usingzz 
(zz 
CryptoStreamzz '
	csEncryptzz( 1
=zz2 3
newzz4 7
CryptoStreamzz8 D
(zzD E
	msEncryptzzE N
,zzN O
	encryptorzzP Y
,zzY Z
CryptoStreamModezz[ k
.zzk l
Writezzl q
)zzq r
)zzr s
{{{ 
using|| 
(|| 
StreamWriter|| +
	swEncrypt||, 5
=||6 7
new||8 ;
StreamWriter||< H
(||H I
	csEncrypt||I R
)||R S
)||S T
{}} 
	swEncrypt~~ %
.~~% &
Write~~& +
(~~+ ,
	plainText~~, 5
)~~5 6
;~~6 7
} 
	encrypted
ÄÄ !
=
ÄÄ" #
	msEncrypt
ÄÄ$ -
.
ÄÄ- .
ToArray
ÄÄ. 5
(
ÄÄ5 6
)
ÄÄ6 7
;
ÄÄ7 8
}
ÅÅ 
}
ÇÇ 
}
ÉÉ 
return
ÖÖ 
	encrypted
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
static
àà 
string
àà (
DecryptStringFromBytes_Aes
àà 0
(
àà0 1
byte
àà1 5
[
àà5 6
]
àà6 7

cipherText
àà8 B
,
ààB C
byte
ààD H
[
ààH I
]
ààI J
Key
ààK N
,
ààN O
byte
ààP T
[
ààT U
]
ààU V
IV
ààW Y
)
ààY Z
{
ââ 	
if
ää 
(
ää 

cipherText
ää 
==
ää 
null
ää "
||
ää# %

cipherText
ää& 0
.
ää0 1
Length
ää1 7
<=
ää8 :
$num
ää; <
)
ää< =
throw
ãã 
new
ãã #
ArgumentNullException
ãã /
(
ãã/ 0
$str
ãã0 <
)
ãã< =
;
ãã= >
if
åå 
(
åå 
Key
åå 
==
åå 
null
åå 
||
åå 
Key
åå "
.
åå" #
Length
åå# )
<=
åå* ,
$num
åå- .
)
åå. /
throw
çç 
new
çç #
ArgumentNullException
çç /
(
çç/ 0
$str
çç0 5
)
çç5 6
;
çç6 7
if
éé 
(
éé 
IV
éé 
==
éé 
null
éé 
||
éé 
IV
éé  
.
éé  !
Length
éé! '
<=
éé( *
$num
éé+ ,
)
éé, -
throw
èè 
new
èè #
ArgumentNullException
èè /
(
èè/ 0
$str
èè0 4
)
èè4 5
;
èè5 6
string
ëë 
	plaintext
ëë 
=
ëë 
null
ëë #
;
ëë# $
using
ìì 
(
ìì 
Aes
ìì 
aesAlg
ìì 
=
ìì 
Aes
ìì  #
.
ìì# $
Create
ìì$ *
(
ìì* +
)
ìì+ ,
)
ìì, -
{
îî 
aesAlg
ïï 
.
ïï 
Key
ïï 
=
ïï 
Key
ïï  
;
ïï  !
aesAlg
ññ 
.
ññ 
IV
ññ 
=
ññ 
IV
ññ 
;
ññ 
ICryptoTransform
òò  
	decryptor
òò! *
=
òò+ ,
aesAlg
òò- 3
.
òò3 4
CreateDecryptor
òò4 C
(
òòC D
aesAlg
òòD J
.
òòJ K
Key
òòK N
,
òòN O
aesAlg
òòP V
.
òòV W
IV
òòW Y
)
òòY Z
;
òòZ [
using
öö 
(
öö 
MemoryStream
öö #
	msDecrypt
öö$ -
=
öö. /
new
öö0 3
MemoryStream
öö4 @
(
öö@ A

cipherText
ööA K
)
ööK L
)
ööL M
{
õõ 
using
úú 
(
úú 
CryptoStream
úú '
	csDecrypt
úú( 1
=
úú2 3
new
úú4 7
CryptoStream
úú8 D
(
úúD E
	msDecrypt
úúE N
,
úúN O
	decryptor
úúP Y
,
úúY Z
CryptoStreamMode
úú[ k
.
úúk l
Read
úúl p
)
úúp q
)
úúq r
{
ùù 
using
ûû 
(
ûû 
StreamReader
ûû +
	srDecrypt
ûû, 5
=
ûû6 7
new
ûû8 ;
StreamReader
ûû< H
(
ûûH I
	csDecrypt
ûûI R
)
ûûR S
)
ûûS T
{
üü 
	plaintext
°° %
=
°°& '
	srDecrypt
°°( 1
.
°°1 2
	ReadToEnd
°°2 ;
(
°°; <
)
°°< =
;
°°= >
}
¢¢ 
}
££ 
}
§§ 
}
•• 
return
ßß 
	plaintext
ßß 
;
ßß 
}
®® 	
}
©© 
}™™ ï
ld:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\RabbitMQ\Producer\UserProducer.cs
	namespace 	
user_service
 
. 
Producer 
{ 
public 

class 
UserProducer 
: 
BackgroundService  1
{ 
private 
readonly 
ConnectionFactory *
_factory+ 3
;3 4
private 
readonly 
IServiceProvider )
_serviceProvider* :
;: ;
private 
readonly 
IUserService %
_userService& 2
;2 3
public 
int 
userID 
; 
public 
UserProducer 
( 
IServiceProvider ,
serviceProvider- <
,< =
int> A
userIdB H
,H I
IUserServiceJ V
userServiceW b
)b c
{ 	
userID 
= 
userId 
; 
_serviceProvider 
= 
serviceProvider .
;. /
_factory 
= 
new 
ConnectionFactory ,
(, -
)- .
;. /
_factory 
. 
HostName 
= 
$str  +
;+ ,
_userService 
= 
userService &
;& '
}   	
	protected"" 
override"" 
async""  
Task""! %
ExecuteAsync""& 2
(""2 3
CancellationToken""3 D
stoppingToken""E R
)""R S
{## 	
using$$ 
var$$ 

connection$$  
=$$! "
_factory$$# +
.$$+ ,
CreateConnection$$, <
($$< =
)$$= >
;$$> ?
using%% 
var%% 
channel%% 
=%% 

connection%%  *
.%%* +
CreateModel%%+ 6
(%%6 7
)%%7 8
;%%8 9
User'' 
user'' 
='' 
await'' 
_userService'' *
.''* +
GetUser''+ 2
(''2 3
userID''3 9
)''9 :
;'': ;
var)) 
body)) 
=)) 
Encoding)) 
.))  
UTF8))  $
.))$ %
GetBytes))% -
())- .
user)). 2
.))2 3
ToString))3 ;
()); <
)))< =
)))= >
;))> ?
channel++ 
.++ 
BasicPublish++  
(++  !
exchange++! )
:++) *
$str+++ -
,++- .

routingKey,,! +
:,,+ ,
$str,,- :
,,,: ;
basicProperties--! 0
:--0 1
null--2 6
,--6 7
body..! %
:..% &
body..' +
)..+ ,
;.., -
Console00 
.00 
	WriteLine00 
(00 
$str00 -
,00- .
user00/ 3
)003 4
;004 5
await22 
Task22 
.22 
CompletedTask22 $
;22$ %
}33 	
}44 
}55 ∆	
sd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Repository\Interfaces\IUserRepository.cs
	namespace 	
user_service
 
. 

Repository !
.! "

Interfaces" ,
{ 
public		 

	interface		 
IUserRepository		 $
{

 
User 
GetUserByEmail 
( 
string "
email# (
)( )
;) *
Task 
< 
User 
> 
GetUser 
( 
int 
id !
)! "
;" #
User 

CreateUser 
( 
User 
user !
)! "
;" #
User 

UpdateUser 
( 
User 
user !
)! "
;" #
void 

DeleteUser 
( 
int 
id 
) 
;  
Task 
< 
IEnumerable 
< 
User 
> 
> 
GetAllUsers  +
(+ ,
), -
;- .
} 
} ¥'
gd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Repository\UserRepository.cs
	namespace

 	
user_service


 
.

 

Repository

 !
{ 
public 

class 
UserRepository 
:  !
IUserRepository" 1
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
UserRepository 
( 
AppDbContext *
context+ 2
)2 3
{ 	
_context 
= 
context 
; 
} 	
public 
User 

CreateUser 
( 
User #
user$ (
)( )
{ 	!
ArgumentNullException !
.! "
ThrowIfNull" -
(- .
user. 2
)2 3
;3 4
_context 
. 
Users 
. 
Add 
( 
user #
)# $
;$ %
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
user 
; 
} 	
public 
void 

DeleteUser 
( 
int "
id# %
)% &
{ 	
User 
user 
= 
_context  
.  !
Users! &
.& '
FirstOrDefault' 5
(5 6
u6 7
=>8 :
u; <
.< =
Id= ?
==@ B
idC E
)E F
;F G
if   
(   
user   
==   
null   
)   
{!! 
throw"" 
new"" !
ArgumentNullException"" /
(""/ 0
$str""0 @
)""@ A
;""A B
}## 
_context$$ 
.$$ 
Users$$ 
.$$ 
Remove$$ !
($$! "
user$$" &
)$$& '
;$$' (
}%% 	
public'' 
async'' 
Task'' 
<'' 
IEnumerable'' %
<''% &
User''& *
>''* +
>''+ ,
GetAllUsers''- 8
(''8 9
)''9 :
{(( 	
return)) 
await)) 
_context)) !
.))! "
Users))" '
.))' (
ToListAsync))( 3
())3 4
)))4 5
;))5 6
}** 	
public,, 
User,, 
GetUserByEmail,, "
(,," #
string,,# )
email,,* /
),,/ 0
{-- 	
return.. 
_context.. 
... 
Users.. !
...! "
FirstOrDefault.." 0
(..0 1
u..1 2
=>..3 5
u..6 7
...7 8
Email..8 =
==..> @
email..A F
)..F G
;..G H
}// 	
public11 
async11 
Task11 
<11 
User11 
>11 
GetUser11  '
(11' (
int11( +
id11, .
)11. /
{22 	
var33 
user33 
=33 
await33 
_context33 %
.33% &
Users33& +
.33+ ,
FirstOrDefaultAsync33, ?
(33? @
x33@ A
=>33B D
x33E F
.33F G
Id33G I
==33J L
id33M O
)33O P
;33P Q
if44 
(44 
user44 
==44 
null44 
)44 
{55 
throw66 
new66 
	Exception66 #
(66# $
$str66$ 4
)664 5
;665 6
}77 
return99 
user99 
;99 
};; 	
public== 
User== 

UpdateUser== 
(== 
User== #
user==$ (
)==( )
{>> 	
User?? 
userToUpdate?? 
=?? 
_context??  (
.??( )
Users??) .
.??. /
FirstOrDefault??/ =
(??= >
u??> ?
=>??@ B
u??C D
.??D E
Id??E G
==??H J
user??K O
.??O P
Id??P R
)??R S
;??S T
userToUpdate@@ 
.@@ 
Name@@ 
=@@ 
user@@  $
.@@$ %
Name@@% )
;@@) *
userToUpdateAA 
.AA 
GradeAA 
=AA  
userAA! %
.AA% &
GradeAA& +
;AA+ ,
userToUpdateBB 
.BB 
SchoolBB 
=BB  !
userBB" &
.BB& '
SchoolBB' -
;BB- .
_contextCC 
.CC 
UsersCC 
.CC 
UpdateCC !
(CC! "
userToUpdateCC" .
)CC. /
;CC/ 0
returnDD 
userToUpdateDD 
;DD  
}FF 	
}GG 
}HH Ç

cd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Services\IUserService.cs
	namespace 	
user_service
 
. 
Services 
{ 
public		 

	interface		 
IUserService		 !
{

 
public 
Task 
< 
IEnumerable 
<  
User  $
>$ %
>% &
GetAllUsers' 2
(2 3
)3 4
;4 5
public 
Task 
< 
User 
> 
GetUser !
(! "
int" %
id& (
)( )
;) *
public 
User 
GetUserByEmail "
(" #
string# )
email* /
)/ 0
;0 1
public 
User 

CreateUser 
( 
User #
user$ (
)( )
;) *
public 
User 

UpdateUser 
( 
User #
user$ (
)( )
;) *
public 
void 

DeleteUser 
( 
int "
id# %
)% &
;& '
} 
} õ
bd:\Kuliah\Fontys\Semester6\Project\study-sync-web-application\user_service\Services\UserService.cs
	namespace 	
user_service
 
. 
Services 
{		 
public

 

class

 
UserService

 
:

 
IUserService

 +
{ 
private 
readonly 
IUserRepository (
_userRepository) 8
;8 9
public 
UserService 
( 
IUserRepository *
userRepository+ 9
)9 :
{ 	
_userRepository 
= 
userRepository ,
;, -
} 	
public 
User 

CreateUser 
( 
User #
user$ (
)( )
{ 	
return 
_userRepository "
." #

CreateUser# -
(- .
user. 2
)2 3
;3 4
} 	
public 
void 

DeleteUser 
( 
int "
id# %
)% &
{ 	
_userRepository 
. 

DeleteUser &
(& '
id' )
)) *
;* +
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
User& *
>* +
>+ ,
GetAllUsers- 8
(8 9
)9 :
{ 	
return 
await 
_userRepository (
.( )
GetAllUsers) 4
(4 5
)5 6
;6 7
} 	
public!! 
User!! 
GetUserByEmail!! "
(!!" #
string!!# )
email!!* /
)!!/ 0
{"" 	
return## 
_userRepository## "
.##" #
GetUserByEmail### 1
(##1 2
email##2 7
)##7 8
;##8 9
}$$ 	
public&& 
async&& 
Task&& 
<&& 
User&& 
>&& 
GetUser&&  '
(&&' (
int&&( +
id&&, .
)&&. /
{'' 	
return(( 
await(( 
_userRepository(( (
.((( )
GetUser(() 0
(((0 1
id((1 3
)((3 4
;((4 5
})) 	
public** 
User** 

UpdateUser** 
(** 
User** #
user**$ (
)**( )
{++ 	
return,, 
_userRepository,, "
.,," #

UpdateUser,,# -
(,,- .
user,,. 2
),,2 3
;,,3 4
}-- 	
}.. 
}// 